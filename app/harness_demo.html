<!doctype html>
<html lang="en" class="govuk-template">
<head>
  <meta charset="utf-8">
  <title>RTF Copy and Paste Test Harness</title>
  <link href="lib/main.css" rel="stylesheet">
  <script src="https://unpkg.com/@webcomponents/custom-elements"></script>
</head>
<body class="govuk-template__body">
  <script>
    document.body.className = ((document.body.className) ? document.body.className + ' js-enabled' : 'js-enabled');
  </script>
  <div class="govuk-width-container">
    <main class="govuk-main-wrapper">
      <h1>Paste Rich Text Here</h1>
      <textarea class="govuk-textarea" id="paste_area" autofocus rows="10"/></textarea>
      <br>
      <div class="output_panel">
        <h4>
          HTML for Rich Text
        </h4>
        <div id='rich_html_info'>
        </div>
      </div>

      <div class="output_panel">
        <h4>
          Stripped HTML
        </h4>
        <div id='stripped_html_info'>
        </div>
      </div>
    </main>
  </div>

  <script type="text/javascript" src="lib/sanitize-html.min.js"></script>
  <script src="https://unpkg.com/turndown/dist/turndown.js"></script>
  <script type="text/javascript"  src="./index.js"></script>

  <script>
    function pasteIntoTextArea(pasteEvent) {
      //This is the HTML used to render the text that is pasted to the clip
      //board.
      var htmlForRtf = pasteEvent.clipboardData.getData('text/html')

      //This is the HTML after we've applied white listing of allowable tags
      //and attributes
      var simplifiedHtml = remove_unsupported_html_features(htmlForRtf);
      var markdownText = convert_html_to_markdown(simplifiedHtml);

      pasteEvent.preventDefault();

      var textAreaElement = document.getElementById("paste_area");
      var currentSelectionRange = getInputSelection(textAreaElement);
      var currentText = document.getElementById("paste_area").value
      var modifiedTextData = insert_text(currentText,
                                         currentSelectionRange['start'],
                                         currentSelectionRange['end'],
                                         markdownText);

      document.getElementById("paste_area").value = modifiedTextData[0];
      document.getElementById("paste_area").selectionEnd = modifiedTextData[1];
      document.getElementById("rich_html_info").textContent = htmlForRtf;
      document.getElementById("stripped_html_info").textContent = simplifiedHtml;
    }
    document.getElementById("paste_area").addEventListener("paste", pasteIntoTextArea);
  </script>
  </body>
</html>
